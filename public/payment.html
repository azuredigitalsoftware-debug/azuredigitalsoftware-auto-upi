<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment | Azure Digital Software</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#0a0f1a;
  font-family:'Inter',sans-serif;
  color:white;
}
.header{
  padding:18px;
  font-size:18px;
  font-weight:600;
  background:#111b2b;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.secure{
  background:#00ffc6;
  padding:5px 10px;
  color:#00261a;
  border-radius:10px;
  font-size:12px;
}
.container{
  padding:20px;
  max-width:500px;
  margin:auto;
}

/* Product Box */
.box{
  background:#121a29;
  border-radius:16px;
  border:1px solid #00ffc633;
  padding:16px;
  text-align:center;
}
.price{
  font-size:30px;
  font-weight:bold;
  color:#00ffc6;
}

/* QR */
.qr-box{
  background:#121a29;
  padding:18px;
  margin-top:18px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.1);
  text-align:center;
}
.qr{
  width:210px;
  height:auto;
  background:white;
  border-radius:10px;
  padding:8px;
}

/* Buttons */
.upi-row{
  display:flex;
  gap:10px;
  margin-top:14px;
}
.upi-btn{
  flex:1;
  background:#182235;
  border:1px solid #00ffc633;
  padding:12px;
  border-radius:12px;
  font-size:14px;
  cursor:pointer;
}

.copy-btn{
  width:100%;
  padding:14px;
  background:#00ffc6;
  color:#002620;
  font-weight:700;
  border:none;
  margin-top:10px;
  border-radius:12px;
  cursor:pointer;
}

/* Timer */
.timer{
  margin-top:18px;
  font-size:14px;
  text-align:center;
  opacity:.8;
}

/* Loader */
.loader{
  text-align:center;
  font-size:50px;
  animation:pulse 1.4s infinite;
  margin-top:20px;
}
@keyframes pulse{
  0%{opacity:.2;transform:scale(0.9);}
  50%{opacity:1;transform:scale(1.15);}
  100%{opacity:.2;transform:scale(0.9);}
}

/* Pay Confirm */
#paidBtn{
  width:100%;
  padding:14px;
  background:#0096ff;
  border:none;
  border-radius:14px;
  margin-top:14px;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
  display:none;
}

/* Upload Popup */
.popup{
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
}
.popup-card{
  width:90%;
  max-width:350px;
  background:#121a29;
  padding:20px;
  border-radius:16px;
  text-align:center;
  border:1px solid #00ffc644;
}
.popup-card input{
  width:100%;
  margin-top:14px;
}
.submit-btn{
  width:100%;
  padding:14px;
  background:#00ffc6;
  border:none;
  margin-top:10px;
  border-radius:12px;
  font-weight:700;
}
.cancel-btn{
  width:100%;
  padding:14px;
  background:#182235;
  border:1px solid #333;
  color:white;
  border-radius:12px;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="header">
  Secure Payment
  <span class="secure">üîí Verified</span>
</div>

<div class="container">

  <div class="box">
    <div style="opacity:.7;font-size:14px;">Filmora 14 Lifetime Access</div>
    <div class="price">‚Çπ199</div>
    <div style="font-size:12px;color:#00ffc6;">Order ID: <b id="orderID"></b></div>
  </div>

  <div class="qr-box">
    <img id="qrImage" class="qr" src="" alt="Generating QR...">
    <p style="opacity:.6;font-size:12px;">Scan with any UPI app</p>
  </div>

<style>
.upi-btn {
  flex: 1;
  background: #00ffc6;
  border: 1px solid rgba(255,255,255,0.12);
  padding: 12px;
  border-radius: 14px;
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: .25s;
}

.upi-btn:hover {
  border-color: #00ffc6;
  box-shadow: 0 0 10px rgba(0,255,198,0.4);
  transform: translateY(-2px);
}

.upi-logo {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background:white;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:2px;
}
.upi-logo img{
  width:100%;
  height:100%;
  border-radius:50%;
}
</style>


<div class="upi-row">

  <button class="upi-btn" onclick="pay()">
    <span class="upi-logo">
      <img src="/uploads/google pay.webp">
    </span>
    Google Pay
  </button>

  <button class="upi-btn" onclick="pay()">
    <span class="upi-logo">
      <img src="/uploads/OIP (2).webp">
    </span>
    PhonePe
  </button>

  <button class="upi-btn" onclick="pay()">
    <span class="upi-logo">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Paytm_logo.png/512px-Paytm_logo.png">
    </span>
    Paytm
  </button>

</div>

<p style="text-align:center;opacity:.6;font-size:12px;margin-top:8px;">
‚ö° Works with ANY UPI app ‚Äî just tap to pay
</p>


  <button class="copy-btn" onclick="copyUPI()">üìã Copy UPI ID: azuredigitalsoftware@nsdl</button>

  <div class="timer" id="timer">‚è≥ Waiting for Payment (30s)...</div>

  <div id="statusIcon" class="loader">üöÄ</div>

  <button id="paidBtn" onclick="openUpload()">I HAVE PAID</button>

</div>

<!-- Upload Screenshot -->
<div id="uploadPopup" class="popup">
  <div class="popup-card">
    <h3>üì∏ Upload Payment Screenshot</h3>
    <input type="file" id="proof" accept="image/*">
    <button class="submit-btn" onclick="submitProof()">Submit</button>
    <button class="cancel-btn" onclick="closePopup()">Cancel</button>
  </div>
</div>

<script>
let orderID = localStorage.getItem("orderID");
if(!orderID) location.href="checkout.html";
document.getElementById("orderID").textContent = orderID;

// Auto QR
const upiId = "azuredigitalsoftware@nsdl";
const name = "Azure Digital";
const amt = "199";
const note = "Filmora Purchase";

const upiURL = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(name)}&am=${amt}&tn=${encodeURIComponent(note)}`;
document.getElementById("qrImage").src = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(upiURL)}`;

function pay(){ window.location.href = upiURL; }
function copyUPI(){ navigator.clipboard.writeText(upiId); alert("Copied"); }

// Timer ‚Üí Show Upload Button
let sec=30;
const timer=setInterval(()=>{
  sec--;
  document.getElementById("timer").innerText=`‚è≥ Waiting for Payment (${sec}s)...`;

  if(sec===0){
    clearInterval(timer);
    document.getElementById("timer").innerText="‚úî Payment Window Ready";
    document.getElementById("paidBtn").style.display="block";
    document.getElementById("statusIcon").innerHTML="üîç";
  }
},1000);

// Upload Proof
function openUpload(){ document.getElementById("uploadPopup").style.display="flex"; }
function closePopup(){ document.getElementById("uploadPopup").style.display="none"; }

async function submitProof(){
  const file=document.getElementById("proof").files[0];
  if(!file) return alert("Upload proof first!");

  const formData=new FormData();
  formData.append("orderId",orderID);
  formData.append("screenshot",file);

  const res=await fetch("/api/upload-proof",{method:"POST",body:formData});
  const data=await res.json();

  closePopup();
  document.getElementById("timer").innerText="‚è≥ Verifying Payment...";
  startPolling();
}

// Live Polling
function startPolling(){
  const poll=setInterval(async()=>{
    const res=await fetch(`/api/order-status/${orderID}`);
    const data=await res.json();

    if(data.status==="approved"){
      clearInterval(poll);
      document.getElementById("statusIcon").innerText="üéâ";
      document.getElementById("timer").innerText="Payment Verified!";
      setTimeout(()=>location.href="success.html",2000);
    }

    if(data.status==="rejected"){
      clearInterval(poll);
      document.getElementById("statusIcon").innerText="‚ö†Ô∏è";
      document.getElementById("timer").innerText="‚ùå Payment Rejected. Contact Support.";
    }

  },3000);
}
</script>

</body>
</html>


