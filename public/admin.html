<script>
// üö® Protect Admin Page
if(localStorage.getItem("adminLoggedIn") !== "true"){
  window.location.href = "admin-login.html";
}
</script>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel | Azure Digital Software</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<button onclick="logout()" style="
  background:#ff4747;
  border:none;
  color:white;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:12px;
">
Logout
</button>


<style>
body{
  margin:0;
  font-family: 'Inter', sans-serif;
  background:#0a0f1a;
  color:white;
}
.header{
  padding:18px;
  background:#111b2b;
  font-size:20px;
  font-weight:700;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #0ff6c652;
}
.refresh-btn{
  background:#00ffc6;
  color:#011;
  border:none;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  font-size:13px;
  font-weight:600;
}

.container{
  padding:16px;
  max-width:1200px;
  margin:auto;
}

.table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

.table th, .table td{
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,0.1);
  text-align:left;
  font-size:14px;
}

.status{
  padding:6px 10px;
  border-radius:12px;
  font-size:12px;
  text-transform:capitalize;
}

.pending{ background:#ffcc0040; color:#ffd84d;}
.payment_review{ background:#0099ff33; color:#009cff;}
.approved{ background:#00ffae33; color:#00ffa6;}
.rejected{ background:#ff333333; color:#ff8989;}

.btn{
  padding:8px 10px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-size:13px;
  margin-right:6px;
  font-weight:600;
}

.approve-btn{ background:#00ffc6; color:#012220; }
.reject-btn{ background:#ff6961; color:white; }

.link{
  color:#00ffc6;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="header">
  ADMIN PANEL
  <button class="refresh-btn" onclick="loadOrders()">üîÑ Refresh</button>
</div>

<div class="container">
  <table class="table">
    <thead>
      <tr>
        <th>Order</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Status</th>
        <th>Proof</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="orderList"></tbody>
  </table>
</div>

<script>
async function loadOrders(){
  const res = await fetch("/api/orders");
  const orders = await res.json();
  
  const table = document.getElementById("orderList");
  table.innerHTML = "";

  orders.slice().reverse().forEach(order => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${order.id}</td>
      <td>${order.name}</td>
      <td>${order.email}</td>
      <td>${order.phone || "-"}</td>
      <td><span class="status ${order.status}">${order.status.replace("_"," ")}</span></td>
      <td>
        ${order.screenshot 
          ? `<a href="${order.screenshot}" target="_blank" class="link">üìé View</a>`
          : "No Upload"}
      </td>
      <td>
        ${order.status !== "approved" ? `
        <button class="btn approve-btn" onclick="approveOrder('${order.id}')">Approve</button>
        <button class="btn reject-btn" onclick="rejectOrder('${order.id}')">Reject</button>` 
        : "‚úî Completed"}
      </td>
    `;

    table.appendChild(row);
  });
}

async function approveOrder(orderId){
  let link = prompt("Enter download link to send to customer:");


  const res = await fetch("/api/orders/" + orderId + "/approve", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ downloadLink: link })
  });

  const data = await res.json();
  if(data.success){
    alert("‚úî Order Approved & Email Sent!");
    loadOrders();
  }else{
    alert("‚ùå Failed. Try again.");
  }
}

async function rejectOrder(orderId){
  let reason = prompt("Enter rejection reason:");
  if(!reason) return alert("Reason required!");

  await fetch("/api/orders/" + orderId + "/reject", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ reason })
  });

  alert("Order Rejected.");
  loadOrders();
}

loadOrders();
</script>

<script>
function logout(){
  localStorage.removeItem("adminLoggedIn");
  window.location.href = "admin-login.html";
}
</script>

</body>
</html>

